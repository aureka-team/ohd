<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de" lang="de">
<head>
    <%= render :partial => '/head' %>
</head>

<body>
    <div id="headerIdentityWrapper">
        <%= render :partial => '/header' %>

        <div id="baseServices">
            <%= render :partial => 'searches/search', :object => @search %>
        </div>

        <hr class="divider" />
    </div>

    <div id="mainWrapper">

        <div id="baseContent">

            <!-- Move this to page bottom?
            <div id="baseContainerNavigationToRoot">
              <div class="baseNavigationToRoot">
                <p class="info"><em>Navigationspfad:</em></p>
                <%#= link_to (t :home), "http://www.zwangsarbeit-archiv.de", :title => "Startseite Zwangsarbeit 1939-1945" %> &raquo;
                <%#= link_to (t :archive), :root, :title => "Startseite Archiv" %>
              </div>
            </div>

            <hr class="divider" />
            <br class="clear" />
            <hr class="divider" />
            //-->

            <a name="inhalt" accesskey="I"></a>

            <div id="innerContent">
                <%= yield %>
            </div>

            <br class="clear" />
            <a href="#seitenanfang" title="Zum Seitenanfang"><img src="<%= image_path 'sprungmarke.gif' %>" alt="Bild Sprungmarke nach oben" border="0" title="" /></a>
            <br class="clear" />

            <div class="clear"></div>
        </div>

        <hr class="divider" />

        <div id="baseContainerRight">

            <% javascript_tag do %>
              var checkedCategories = [];
            <% end %>

            <%= render :partial => 'searches/facets', :object => @search %>

            <% javascript_tag do %>

              var categoryElems = $$('fieldset.facet-field');

              var categoryChange = false;

              // clearing the fulltext field before submission or editing
              function clearFulltextField(id) {
                var elem = $(id);
                if(elem) {
                  if(elem.value == '<%= t('search_term') %>') {
                    elem.value = '';
                  }
                }
              }

              // blind effect for category facets
              function toggleCategory(id, blindToggle) {
                var cat_index = -1;
                for(var i=0; i< categoryElems.length; i++) {
                  if (id == categoryElems[i].id) {
                      cat_index = i;
                  }
                }
                if(cat_index > -1) {
                  var parent = $(id.sub(/_query$/,''));
                  if(parent.hasClassName('closed')) {
                    checkFormSubmission(parent.id);
                    // show
                    if(blindToggle) {
                      Effect.BlindDown(id, { duration: 0.4, transition: Effect.Transitions.sinoidal });
                    } else {
                      Element.show(id);
                    }
                    parent.removeClassName('closed');
                    parent.addClassName('open');
                  } else {
                    // hide
                    if(blindToggle) {
                      Effect.BlindUp(id, { duration: 0.4, transition: Effect.Transitions.sinoidal, afterFinish: markClosed(parent) });
                    } else {
                      Element.hide(id);
                      markClosed(parent);
                    }
                  }
                }
              };

              // check for form submission
              function checkFormSubmission(openCategory) {
                if(categoryChange) {
                  if(openCategory) {
                    $('open_category').value = openCategory;
                  }
                  submitViaAjax();
                }
              };

              // closing happens after the blind effect finishes...
              function markClosed(elem) {
                elem.removeClassName('open');
                elem.addClassName('closed');
                checkFormSubmission(false);
              };

              function categoryState(id, state, checkbox) {
                  var input = $(id);
                  if(checkbox) {
                      input.checked = state;
                  } else {
                      input.value = '';
                  }
              };

              checkedCategories.each(function(id) {
                  categoryState(id, true, true);
              });

              function submitViaAjax(){
                beforeSubmit();
                Form.request('search_facets');
              };

              function beforeSubmit() {
                categoryChange = false;
                clearFulltextField('searchInput');
                $('search_facets_overlay').show();
                $('search_header_overlay').show();
              };

              function afterResponse() {
                $('search_header_overlay').hide();
                $('search_facets_overlay').hide();
              };

          <% end %>

        </div>

        <div id="mainWrapperClear">&nbsp;</div>

    </div>
    <!-- Ende mainWrapper -->

    <hr class="divider" />

    <div id="baseContainerFooter">
        <div class="left">Stand:20.01.2009</div>
    </div>

    <a name="seitenende" accesskey="u"></a>

    <hr class="divider" />

    <!-- Info: Die folgenden Symbole werden nur in der Druckvorschau (separates Popup) und bei der Ausgabe auf einem Drucker verwendet/eingeblendet.-->

    <div id="printlogo">
        <p class="info"><em>Diese Grafiken werden nur in der Druckvorschau verwendet:</em></p>
        <img src="<%= image_path 'zwar_logo_print.gif' %>" border="0" width="262" height="73" title="Druckversion des Logos" alt="Druckversion des Logos" />
    </div>

    <!-- /noindex -->

</body>
</html>
