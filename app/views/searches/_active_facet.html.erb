<% facet_dom_id = "selected_#{active_facet}" %>
<% query = query.to_a unless query.is_a?(Array) %>
<% is_category = Project.is_category?(active_facet) %>
<% human_readable_facet_name = (is_category ? Project.category_name(active_facet, I18n.locale) : t(active_facet.singularize, :scope => :facets)) %>
<div id="<%= facet_dom_id %>" class="active-facet">
  <span class="facet-name"><%= human_readable_facet_name %>:</span>

  <ul>
  <% if is_category or active_facet == 'language_id' %>

    <% clazz = (is_category ? RegistryEntry : Language) %>
    <% query = query.map{|c| c.to_i != 0 ? begin; clazz.find(c); rescue; nil; end : nil }.compact %>

    <% query.each_with_index do |category, index| %>
      <li><%= category.to_s -%><%= (index == query.size-1) ? '' : ','-%></li>
    <% end %>

  <% elsif active_facet == 'interview_id' %>

    <% query = query.map{|i| i.to_i != 0 ? begin; Interview.find(i); rescue; nil; end : nil }.compact %>

    <% query.each do |interview| %>
      <% interview.full_title(I18n.locale).split(' ').each do |name_token| %>
        <li><%= name_token %></li>
      <% end %>
    <% end %>

  <% end %>
  </ul>

  <%= link_to_function 'entfernen', :class=>'facet-remove', :title => t('.remove') do |page|
      page[facet_dom_id].visual_effect :switch_off
      query.each do |facet_object|
        page << "Element.remove('#{active_facet}_#{facet_object[:id]}');"
      end
      page << "submitViaAjax();"
  end %>

  <fieldset style="display:none" id="<%= active_facet %>_query" class="facet-field">

    <% query.each do |facet_object| %>
      <%= hidden_field_tag "#{active_facet}[]", facet_object[:id], { :id => "#{active_facet}_#{facet_object[:id]}"} %>
    <% end %>

  </fieldset>
</div>
