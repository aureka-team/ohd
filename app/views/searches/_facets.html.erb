<div id="searchReset">
  <% if facets.hits < Interview::NUMBER_OF_INTERVIEWS %>
    <%= reset_search_link({ :before => "beforeSubmit();" }) %>
  <% end %>
</div>

<div class="baseListBox">

  <% remote_form_for facets,
                     :url => new_search_path,
                     :method => :get,
                     :html => { :action => new_search_path,
                                :method => :get,
                                # no changes on complete are needed, since we redirect!
                                :name => "searchFacets",
                                :id => "search_facets" } do |search_facets| %>

    <div class="fragmentTitle">
        <% search_facets.object.fulltext = t('search_term', :scope => 'user_interface.search') if search_facets.object.fulltext.blank? %>
        <%= search_facets.text_field :fulltext, :name => 'fulltext', :id => 'searchInput', :class => 'baseInputSearch searchInput', :title => t('fulltext_title', :scope => 'user_interface.search'), :onFocus => "clearFulltextField('searchInput');" %>
        <%= search_facets.submit 'suchen', :class => 'search', :id => 'searchButton', :alt => t('.search'), :type => :image, :src => image_path('pfeil_rot_rechts.gif'), :onclick => "submitViaAjax(); false;" %>
        <%= hidden_field_tag 'open_category', '', :id => 'open_category' %>
    </div>

    <noscript>
      <div class="warning">
        <h4><%= t('search_no_javascript', :scope => 'user_interface.messages') %></h4>
      </div>
    </noscript>

    <% facets.query_facets.each do |facet| %>
      <%= render :partial => '/searches/active_facet', :object => facet.first, :locals => { :query => facet.last } %>
    <% end %>

    <% facets.unqueried_facets.each do |facet| %>
      <%= render :partial => '/searches/facet_option', :object => facet, :locals => { :search_facets => search_facets, :category_facet => facets.send(facet.first).is_a?(Array)} %>
    <% end %>

  <% end %>

  <% unless facets.open_category.blank? %>
    <% javascript_tag do %>
      toggleCategory('<%= facets.open_category %>_query', true);
    <% end %>
  <% end %>

  <% javascript_tag do %>
      Event.observe(document, 'keypress', function(event){ if(event.keyCode == Event.KEY_RETURN) { /* catch these keycodes to submit the forms! */ }} );
  <% end %>

</div>
