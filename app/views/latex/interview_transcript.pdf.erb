<% 
  interviewee_name = @interview.interviewees.first.name(@project_locale)
  title = "#{I18n.t('transcript_header', locale: @alpha2_locale)} #{interviewee_name}"
  header_text = "#{I18n.t('transcript', locale: @alpha2_locale)}:  #{I18n.t('interview_with', locale: @alpha2_locale)} #{interviewee_name} (#{I18n.t('archive_id', locale: @alpha2_locale)} #{@interview.archive_id})"
  tape = 0
  speaker_id = nil
 %>

\title{<%= title %>}

\begin{document}

<%= render partial: "./latex/header_footer",
           locals: {
               header_text: header_text
           } %>

<%= render partial: "./latex/title",
           locals: {
               title: title,
               space_above: 3,
               space_below: 3,
               font_size: 18

           } %>
<%= render partial: "./latex/info" %>
<%= render partial: "./latex/citation",
           locals: {
               interviewee_name: interviewee_name
           } %>

\newpage

<%= render partial: "./latex/observation" if @interview.observations(@project_locale) %>

<%# set title of  tableofcontents: %>
\renewcommand{\contentsname}{<%= I18n.t('table_of_contents', locale: @alpha2_locale) %>}
\tableofcontents

\newpage

<%= render partial: "./latex/legend" %>

\newpage

<%= render partial: "./latex/title",
           locals: {
               title: title,
               space_above: 0,
               space_below: 0.01,
               font_size: 13
           } %>

<% @interview.segments.includes(:translations).each_with_index do |segment, index| %>

  <% space_above = 0.4 %>

  <% if !segment.mainheading.blank? %>
    \section{<%= segment.mainheading %>}
    <% if tape != segment.tape.number %> 
      <% space_above = 0 %>
      <%= render partial: "./latex/title", locals: {title: "#{I18n.t('tape', locale: @alpha2_locale)} #{segment.tape.number}", space_above: 0.7, space_below: 0.05, font_size: 10} %>
    <% end %>
    <%= render partial: "./latex/title", locals: {title: Time.parse(segment.raw_timecode).strftime("%H:%M:%S"), space_above: space_above, space_below: 0, font_size: 10} %>
  <% end %>

  <% if !segment.subheading.blank? %>
    \subsection{<%= segment.subheading %>}
    <%= render partial: "./latex/title", locals: {title: Time.parse(segment.raw_timecode).strftime("%H:%M:%S"), space_above: 0.4, space_below: 0, font_size: 10} %>
  <% end %>

  <% if segment.speaker_id != speaker_id && segment.speaking_person %>
    \vspace*{<%= 0.2 %>cm}
    \textit{<%= segment.speaking_person.name(@project_locale) + ': ' %>}
  <% end %>
  <%= latex_escape(segment.text(@project_locale)) %>

  <% tape = segment.tape.number %>
  <% speaker_id = segment.speaker_id %>

<% end %>

